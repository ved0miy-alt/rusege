<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ï–ì–≠ ‚Äî –£–¥–∞—Ä–µ–Ω–∏–µ (MiniApp)</title>
<style>
* { box-sizing: border-box; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; }
body { margin:0; background:#000; color:#fff; display:flex; flex-direction:column; height:100vh; }
.top { text-align:center; padding:10px; font-size:0.9rem; }
.word { flex:1; display:flex; justify-content:center; align-items:center; white-space:nowrap; overflow:hidden; font-weight:600; letter-spacing:8px; font-size:10vw; transition:letter-spacing 0.1s ease; }
.letter { display:inline-block; padding:10px; margin:2px; border-radius:50%; cursor:pointer; user-select:none; }
.wrong-highlight { background:#ff453a; box-shadow:0 0 10px #ff453a; }
.message { text-align:center; font-size:0.95rem; min-height:24px; padding:6px; color:#2AABEE; }
.bottom { padding:15px; display:flex; gap:10px; align-items:center; }
.score { width:60px; height:60px; background:#1c1c1e; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:1.4rem; border:2px solid #333; color:#2AABEE; }
.input-box { flex:1; }
.input-box input { width:100%; padding:14px; border-radius:40px; border:none; background:#1c1c1e; color:white; text-align:center; font-size:1.2rem; }
.menu { width:60px; height:60px; border-radius:50%; background:#1c1c1e; display:flex; justify-content:center; align-items:center; font-size:24px; border:2px solid #333; color:#2AABEE; cursor:pointer; }
</style>
</head>
<body>

<div class="top">üéì –ï–ì–≠ ‚Äî –æ—Ä—Ñ–æ—ç–ø–∏—è</div>
<div class="word" id="word"></div>
<div class="message" id="message"></div>

<div class="bottom">
  <div class="score" id="score">0</div>
  <div class="input-box">
    <input type="text" id="answerInput" inputmode="numeric" pattern="[0-9]*" placeholder="–ù–æ–º–µ—Ä —É–¥–∞—Ä–Ω–æ–π –±—É–∫–≤—ã">
  </div>
  <div class="menu" id="nextBtn">‚Üª</div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
// Telegram WebApp
const tg = window.Telegram.WebApp;
tg.expand();
tg.ready();

// ======== –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤ —Å —É–¥–∞—Ä–µ–Ω–∏–µ–º (–∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞) ========
const rawBank = [
  "–∞—ç—Ä–æ–ø–û—Ä—Ç—ã","–±–ê–Ω—Ç—ã","–±–û—Ä–æ–¥—É","–±—É—Ö–≥–ê–ª—Ç–µ—Ä–æ–≤","–≤–µ—Ä–æ–∏—Å–ø–æ–≤–ï–¥–∞–Ω–∏–µ",
  "–≤–æ–¥–æ–ø—Ä–æ–≤–û–¥","–≥–∞–∑–æ–ø—Ä–æ–≤–û–¥","–≥—Ä–∞–∂–¥–ê–Ω—Å—Ç–≤–æ","–¥–µ—Ñ–ò—Å","–¥–µ—à–µ–≤–ò–∑–Ω–∞",
  "–¥–∏—Å–ø–∞–Ω—Å–ï—Ä","–¥–æ–∫—É–º–ï–Ω—Ç","–¥–æ—Å–£–≥","–µ—Ä–µ—Ç–ò–∫","–∂–∞–ª—é–∑–ò",
  "–∑–Ω–ê—á–∏–º–æ—Å—Ç—å","–∫–∞—Ç–∞–ª–û–≥","–∫–≤–∞—Ä—Ç–ê–ª","–∫–∏–ª–æ–º–ï—Ç—Ä","–∫–û–Ω—É—Å–æ–≤",
  "–∫–æ—Ä–´—Å—Ç—å","–∫—Ä–ê–Ω—ã","–∫—Ä–µ–º–ï–Ω—å","–∫—Ä–µ–º–Ω–Ø","–ª–ï–∫—Ç–æ—Ä–æ–≤",
  "–ª–û–∫—Ç—è","–ª—ã–∂–Ω–Ø","–º–ï—Å—Ç–Ω–æ—Å—Ç–µ–π","–Ω–∞–º–ï—Ä–µ–Ω–∏–µ","–Ω–ï–¥—Ä—É–≥"
];

// –ü–∞—Ä—Å–∏–º: –Ω–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å —É–¥–∞—Ä–Ω–æ–π –±—É–∫–≤—ã
function parseBank(bank){
  return bank.map(word=>{
    let stress=-1;
    for(let i=0;i<word.length;i++){
      if(word[i]!==word[i].toLowerCase()) stress=i;
    }
    if(stress===-1) stress=0;
    return {word:word, stress:stress};
  });
}

const bank = parseBank(rawBank);
let currentItem;
let score = 0;

const wordDiv = document.getElementById("word");
const messageDiv = document.getElementById("message");
const scoreEl = document.getElementById("score");
const input = document.getElementById("answerInput");
const nextBtn = document.getElementById("nextBtn");

// –ü–æ–∫–∞–∑ —Å–ª–æ–≤–∞
function showWord(item){
  wordDiv.innerHTML="";
  item.word.split("").forEach((ch,i)=>{
    const span=document.createElement("span");
    span.className="letter";
    span.innerText=ch.toUpperCase();
    span.onclick=()=>check(i);
    wordDiv.appendChild(span);
  });
  setTimeout(fitWord,50);
}

// –ü–æ–¥–≥–æ–Ω–∫–∞ –º–µ–∂–±—É–∫–≤–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
function fitWord(){
  let spacing=8;
  wordDiv.style.letterSpacing = spacing+"px";
  while(wordDiv.scrollWidth>wordDiv.clientWidth && spacing>-10){
    spacing--;
    wordDiv.style.letterSpacing=spacing+"px";
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞
function loadNew(){
  currentItem = bank[Math.floor(Math.random()*bank.length)];
  showWord(currentItem);
  messageDiv.innerText="";
  input.value="";
  input.focus();
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
function check(index){
  if(index===currentItem.stress){
    score++;
    scoreEl.innerText=score;
    messageDiv.innerText="‚úÖ –í–µ—Ä–Ω–æ!";
    setTimeout(loadNew,400);
  } else {
    messageDiv.innerText=`‚ùå –û—à–∏–±–∫–∞! –ü–æ–∑–∏—Ü–∏—è: ${currentItem.stress+1}`;
    showCorrect();
  }
}

// –ü–æ–∫–∞–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –±—É–∫–≤—ã
function showCorrect(){
  const letters=document.querySelectorAll(".letter");
  letters[currentItem.stress].classList.add("wrong-highlight");
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ —á–µ—Ä–µ–∑ input
input.addEventListener("keypress",e=>{
  if(e.key==="Enter"){
    const val=parseInt(input.value)-1;
    if(!isNaN(val) && val>=0 && val<currentItem.word.length) check(val);
    input.value="";
  }
});

// –ö–Ω–æ–ø–∫–∞ "—Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ"
nextBtn.onclick=loadNew;

// –ü–æ–¥–≥–æ–Ω–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
window.addEventListener("resize",fitWord);

// –°—Ç–∞—Ä—Ç
scoreEl.innerText=score;
loadNew();
</script>

</body>
</html>
