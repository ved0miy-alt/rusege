<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ЕГЭ — MiniApp</title>
<style>
* { box-sizing: border-box; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; margin:0; padding:0; }
body { background:#000; color:#fff; display:flex; flex-direction:column; height:100vh; }
.top { display:flex; justify-content:center; align-items:center; padding:10px; gap:12px; }
.mode-btn { flex:1; text-align:center; padding:8px; border-radius:25px; border:2px solid #2AABEE; color:#2AABEE; font-weight:600; cursor:pointer; transition:0.2s; user-select:none; }
.mode-btn.active { background:#2AABEE; color:#000; }
.word { flex:1; display:flex; justify-content:center; align-items:center; white-space:nowrap; overflow:hidden; font-weight:600; transition:letter-spacing 0.1s ease; }
.letter { display:inline-block; padding:6px; margin:2px; border-radius:50%; cursor:pointer; user-select:none; transition:0.2s; }
.wrong-highlight { background:#ff453a; box-shadow:0 0 8px #ff453a; }
.message { text-align:center; font-size:0.95rem; min-height:24px; padding:6px; color:#2AABEE; }
.bottom { padding:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:center; }
.score { min-width:50px; height:50px; background:#1c1c1e; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:1.3rem; border:2px solid #333; color:#2AABEE; }
.input-box { flex:1 1 150px; }
.input-box input { width:100%; padding:12px; border-radius:35px; border:none; background:#1c1c1e; color:white; text-align:center; font-size:1rem; }
.menu { width:50px; height:50px; border-radius:50%; background:#1c1c1e; display:flex; justify-content:center; align-items:center; font-size:22px; border:2px solid #333; color:#2AABEE; cursor:pointer; }
@media (max-width: 360px) {
  .letter { padding:4px; margin:1px; }
  .input-box input { font-size:0.95rem; padding:10px; }
  .score { min-width:45px; height:45px; font-size:1.1rem; }
  .menu { width:45px; height:45px; font-size:20px; }
}
</style>
</head>
<body>

<div class="top">
  <div class="mode-btn active" id="stressMode">Ударения</div>
  <div class="mode-btn" id="rootsMode">Корни</div>
</div>

<div class="word" id="word"></div>
<div class="message" id="message"></div>

<div class="bottom">
  <div class="score" id="score">0</div>
  <div class="input-box">
    <input type="text" id="answerInput" inputmode="numeric" pattern="[0-9]*" placeholder="Номер буквы">
  </div>
  <div class="menu" id="nextBtn">↻</div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
const tg = window.Telegram.WebApp;
tg.expand();
tg.ready();

// ======== Банк слов ========
const stressBank = ["аэропОрты", "бАнты", "бОроду", "бухгАлтеров", "вероисповЕдание",
        "водопровОд", "газопровОд", "граждАнство", "дефИс", "дешевИзна",
        "диспансЕр", "договорËнность", "докумЕнт", "досУг", "еретИк",
        "жалюзИ", "знАчимость", "Иксы", "каталОг", "квартАл",
        "киломЕтр", "кОнусов", "корЫсть", "крАны", "кремЕнь",
        "кремнЯ", "лЕкторов", "лОктя", "лыжнЯ", "мЕстностей",
        "намЕрение", "нЕдруг", "недУг", "некролОг", "нЕнависть",
        "нефтепровОд", "новостЕй", "нОгтя", "Отзыв (о книге)", "отзЫв (посла из страны)",
        "Отрочество", "партЕр", "портфЕль", "придАное", "призЫв",
        "свЁкла", "сирОты", "созЫв", "сосредотОчение", "срЕдства",
        "стАтуя", "столЯр", "тамОжня", "тОрты", "тУфля",
        "цемЕнт", "цЕнтнер", "цепОчка", "шАрфы", "шофЁр",
        "экспЕрт", "вернА", "знАчимый", "красИвее", "кУхонный",
        "ловкА", "мозаИчный", "оптОвый", "прозорлИвый", "прозорлИва",
        "слИвовый", "бралАсь", "взялА", "взялАсь", "влилАсь",
        "ворвалАсь", "воспринЯть", "воссоздалА", "вручИт", "гналА",
        "гналАсь", "добралА", "добралАсь", "дождалАсь", "дозвонИтся",
        "дозИровать", "ждалА", "закУпорить", "занЯть", "заперлА",
        "запломбировАть", "защемИт", "звалА", "звонИт", "кАшлянуть",
        "клАла", "клЕить", "кралАсь", "кровоточИть", "лгалА",
        "лилА", "лилАсь", "наделИт", "надорвалАсь", "назвалАсь",
        "накренИтся", "налилА", "нарвалА", "начАть", "нАчал",
        "началА", "нАчали", "обзвонИт", "облегчИть", "облилАсь",
        "обнялАсь", "обогналА", "ободралА", "ободрИть", "ободрИться",
        "ободрИтся", "обострИть", "одолжИть", "одолжИт", "озлОбить",
        "оклЕить", "окружИт", "опОшлить", "освЕдомиться", "освЕдомится",
        "отбылА", "отдалА", "откУпорить", "отозвАла", "отозвалАсь",
        "перезвонИт", "перелилА", "плодоносИть", "пломбировАть", "повторИт",
        "позвалА", "позвонИт", "полилА", "положИть", "положИл",
        "понЯть", "понялА", "послАла", "прибЫть", "прИбыл",
        "прибылА", "прИбыли", "принЯть", "прИнял", "принялА",
        "прИняли", "рвалА", "сверлИт", "снялА", "создалА",
        "сорвалА", "убралА", "углубИть", "укрепИт", "чЕрпать",
        "щемИт", "щЁлкать", "довезЁнный", "зАгнутый", "зАнятый",
        "занятА", "зАпертый", "заселЁнный", "заселенА", "кровоточАщий",
        "нажИвший", "налИвший", "нанЯвшийся", "начАвший", "нАчатый",
        "низведЁнный", "облегчЁнный", "ободрЁнный", "обострЁнный", "отключЁнный",
        "повторЁнный", "поделЁнный", "понЯвший", "прИнятый", "принятА",
        "приручЁнный", "прожИвший", "снятА", "сОгнутый", "углублЁнный",
        "закУпорив", "начАв", "начАвшись", "отдАв", "понЯв",
        "прибЫв", "создАв", "вОвремя", "дОверху", "дОнизу",
        "дОсуха", "зАсветло", "красИвее", "надОлго", "ненадОлго"];
const rootsBank = ["корень1","корень2","корень3"]; // сюда добавь свои слова с корнями

function parseBank(bank){
  return bank.map(word=>{
    let stress=-1;
    for(let i=0;i<word.length;i++){
      if(word[i]!==word[i].toLowerCase()) stress=i;
    }
    if(stress===-1) stress=0;
    return {word:word, stress:stress};
  });
}

const banks = {
  stress: parseBank(stressBank),
  roots: parseBank(rootsBank)
};

// ======== Переменные ========
let currentMode = "stress"; // stress или roots
let currentItem;
let score = 0;

const wordDiv = document.getElementById("word");
const messageDiv = document.getElementById("message");
const scoreEl = document.getElementById("score");
const input = document.getElementById("answerInput");
const nextBtn = document.getElementById("nextBtn");

const stressBtn = document.getElementById("stressMode");
const rootsBtn = document.getElementById("rootsMode");

// ======== Функции ========
function fitWord(){
  const letters = wordDiv.querySelectorAll(".letter");
  if(letters.length===0) return;
  let fontSize = window.innerWidth / (letters.length + 1);
  fontSize = Math.min(Math.max(fontSize*0.6,16),64);
  letters.forEach(l=>l.style.fontSize = fontSize+"px");
}

function showWord(item){
  wordDiv.innerHTML="";
  item.word.split("").forEach((ch,i)=>{
    const span = document.createElement("span");
    span.className="letter";
    span.innerText = ch.toUpperCase();
    span.onclick = ()=>check(i);
    wordDiv.appendChild(span);
  });
  setTimeout(fitWord,50);
}

function showCorrect(){
  const letters=document.querySelectorAll(".letter");
  letters[currentItem.stress].classList.add("wrong-highlight");
}

function check(index){
  if(index===currentItem.stress){
    score++;
    scoreEl.innerText=score;
    messageDiv.innerText="✅ Верно!";
    setTimeout(loadNew,400);
  } else {
    messageDiv.innerText=`❌ Ошибка! Позиция: ${currentItem.stress+1}`;
    showCorrect();
  }
}

function loadNew(){
  const bank = banks[currentMode];
  currentItem = bank[Math.floor(Math.random()*bank.length)];
  showWord(currentItem);
  messageDiv.innerText="";
  input.value="";
  input.focus();
}

// ======== Переключение режимов ========
function setMode(mode){
  currentMode = mode;
  if(mode==="stress"){
    stressBtn.classList.add("active");
    rootsBtn.classList.remove("active");
  } else {
    rootsBtn.classList.add("active");
    stressBtn.classList.remove("active");
  }
  score = 0;
  scoreEl.innerText=score;
  loadNew();
}

stressBtn.onclick = ()=>setMode("stress");
rootsBtn.onclick = ()=>setMode("roots");

// ======== События ========
input.addEventListener("keypress",e=>{
  if(e.key==="Enter"){
    const val = parseInt(input.value)-1;
    if(!isNaN(val) && val>=0 && val<currentItem.word.length) check(val);
    input.value="";
  }
});

nextBtn.onclick = loadNew;
window.addEventListener("resize",fitWord);

// ======== Старт ========
scoreEl.innerText=score;
loadNew();

</script>
</body>
</html>
